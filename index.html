<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Reconocimiento de Voz Odontología</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
    }

    .estado {
      font-weight: bold;
      padding: 4px 8px;
      border-radius: 5px;
      margin-left: 10px;
    }

    .activo {
      background-color: #4CAF50;
      color: white;
    }

    .inactivo {
      background-color: #f44336;
      color: white;
    }

    textarea {
      width: 100%;
      height: 120px;
      font-size: 16px;
      margin-bottom: 20px;
      padding: 10px;
    }

    .instrucciones {
      background-color: #f0f8ff;
      border: 1px solid #ccc;
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 20px;
    }

    .instrucciones h3 {
      margin-top: 0;
    }

    .botones {
      margin-bottom: 20px;
    }

    .botones button {
      margin-right: 10px;
      padding: 10px 15px;
      font-size: 15px;
    }
  </style>
</head>
<body>
  <h2>Reconocimiento de Voz Odontología</h2>

  <div class="instrucciones">
    <h3>🗣️ Instrucciones de activación por voz:</h3>
    <ul>
      <li>✅ Para activar el dictado en <strong>Historia Clínica</strong>, di: <em><strong>“dictado historia clínica”</strong></em></li>
      <li>🚫 Para detener el dictado en <strong>Historia Clínica</strong>, di: <em><strong>“terminar historia clínica”</strong></em></li>
      <li>✅ Para activar el dictado en <strong>Plan de Tratamiento</strong>, di: <em><strong>“dictado plan de tratamiento”</strong></em></li>
      <li>🚫 Para detener el dictado en <strong>Plan de Tratamiento</strong>, di: <em><strong>“terminar plan de tratamiento”</strong></em></li>
    </ul>
  </div>

  <div class="botones">
    <button id="startButton">🎤 Iniciar Reconocimiento</button>
    <button id="stopButton">🛑 Detener Reconocimiento</button>
  </div>

  <h3>Historia Clínica
    <span id="estadoHC" class="estado inactivo">Dictado inactivo</span>
  </h3>
  <textarea id="historiaClinica" placeholder="Dictado aquí..."></textarea>

  <h3>Plan de Tratamiento
    <span id="estadoPT" class="estado inactivo">Dictado inactivo</span>
  </h3>
  <textarea id="planTratamiento" placeholder="Dictado aquí..."></textarea>

  <script>
    const startButton = document.getElementById('startButton');
    const stopButton = document.getElementById('stopButton');
    const historiaClinica = document.getElementById('historiaClinica');
    const planTratamiento = document.getElementById('planTratamiento');
    const estadoHC = document.getElementById('estadoHC');
    const estadoPT = document.getElementById('estadoPT');

    let modo = null;
    let reconocimientoActivo = false;

    function beep() {
      const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      const oscillator = audioCtx.createOscillator();
      const gainNode = audioCtx.createGain();

      oscillator.type = 'sine';
      oscillator.frequency.setValueAtTime(800, audioCtx.currentTime);
      gainNode.gain.setValueAtTime(0.2, audioCtx.currentTime);

      oscillator.connect(gainNode);
      gainNode.connect(audioCtx.destination);

      oscillator.start();
      oscillator.stop(audioCtx.currentTime + 0.2);
    }

    function actualizarEstado(campo, activo) {
      const estado = campo === 'hc' ? estadoHC : estadoPT;
      if (activo) {
        estado.textContent = 'Dictado activo';
        estado.classList.remove('inactivo');
        estado.classList.add('activo');
      } else {
        estado.textContent = 'Dictado inactivo';
        estado.classList.remove('activo');
        estado.classList.add('inactivo');
      }
    }

    const recognition = new webkitSpeechRecognition();
    recognition.lang = 'es-ES';
    recognition.continuous = true;
    recognition.interimResults = false;

    recognition.onresult = (event) => {
      const transcript = event.results[event.results.length - 1][0].transcript.trim().toLowerCase();
      console.log("Escuchado:", transcript);

      if (transcript.includes("dictado historia clínica")) {
        modo = 'hc';
        actualizarEstado('hc', true);
        actualizarEstado('pt', false);
        beep();
      } else if (transcript.includes("terminar historia clínica")) {
        modo = null;
        actualizarEstado('hc', false);
        beep();
      } else if (transcript.includes("dictado plan de tratamiento")) {
        modo = 'pt';
        actualizarEstado('pt', true);
        actualizarEstado('hc', false);
        beep();
      } else if (transcript.includes("terminar plan de tratamiento")) {
        modo = null;
        actualizarEstado('pt', false);
        beep();
      } else if (modo === 'hc') {
        historiaClinica.value += transcript + '. ';
      } else if (modo === 'pt') {
        planTratamiento.value += transcript + '. ';
      }
    };

    recognition.onerror = (event) => {
      console.error("Error:", event.error);
    };

    recognition.onend = () => {
      if (reconocimientoActivo) {
        recognition.start(); // solo reinicia si sigue activo
      }
    };

    startButton.addEventListener("click", () => {
      reconocimientoActivo = true;
      recognition.start();
      alert("🎧 Escuchando... Usa los comandos de voz para comenzar a dictar.");
    });

    stopButton.addEventListener("click", () => {
      reconocimientoActivo = false;
      recognition.stop();
      modo = null;
      actualizarEstado('hc', false);
      actualizarEstado('pt', false);
    });
  </script>
</body>
</html>




