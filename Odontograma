<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Odontograma FDI con Leyenda y Reporte</title>

  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #f9f9f9;
      padding: 30px;
      color: #333;
    }

    h1 {
      text-align: center;
      color: #0D47A1;
    }

    /* ======== ODONTOGRAMA (original, sin cambios) ========= */

    .odontograma {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 40px;
      position: relative;
      z-index: 10;
    }

    .seccion { text-align: center; }
    .etiqueta {
      font-weight: bold;
      color: #0D47A1;
      margin-bottom: 10px;
    }

    .fila {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 16px;
    }

    .contenedor-diente {
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .diente {
      position: relative;
      width: 64px;
      height: 64px;
      border-radius: 50%;
      border: 2px solid #ccc;
      background: white;
      overflow: hidden;
    }

    .cara {
      position: absolute;
      width: 100%;
      height: 100%;
      cursor: pointer;
      transition: background 0.2s;
      z-index: 1;
    }

    .cara::before,
    .cara::after {
      content: "";
      position: absolute;
      width: 1px;
      height: 100%;
      background: gray;
      left: 50%;
      top: 0;
      z-index: 0;
    }

    .cara::before { transform: rotate(45deg); }
    .cara::after  { transform: rotate(-45deg); }

    .superior { clip-path: polygon(50% 50%, 0% 0%, 100% 0%); }
    .inferior { clip-path: polygon(50% 50%, 0% 100%, 100% 100%); }
    .izquierda { clip-path: polygon(50% 50%, 0% 0%, 0% 100%); }
    .derecha   { clip-path: polygon(50% 50%, 100% 0%, 100% 100%); }

    .centro {
      width: 24px;
      height: 24px;
      border-radius: 50%;
      border: 1.5px solid gray;
      background: white;
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      z-index: 5;
      cursor: pointer;
    }

    .numero {
      font-size: 12px;
      color: #555;
      margin-top: 5px;
    }

    .popup {
      position: absolute;
      display: none;
      background: #fff;
      border: 1px solid #ccc;
      padding: 10px;
      z-index: 100;
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
      max-height: 250px;
      overflow-y: auto;
    }

    .popup div {
      margin: 4px 0;
      font-size: 13px;
      display: flex;
      align-items: center;
      gap: 6px;
      cursor: pointer;
    }

    .color-box {
      width: 12px;
      height: 12px;
      border-radius: 2px;
      display: inline-block;
      margin-right: 4px;
    }

    /* ======== LEYENDA ========= */
    .leyenda {
      max-width: 1000px;
      margin: 60px auto 20px;
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    .leyenda h2 {
      text-align: center;
      color: #0D47A1;
      margin-bottom: 16px;
    }

    .leyenda-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
      gap: 8px 16px;
      font-size: 14px;
    }
  </style>
</head>

<body>

<h1>Odontograma Internacional FDI</h1>

<!-- ======================================================
     ðŸ”¥ LINEAS AMARILLAS + TEXTOS ROJOS AJUSTADOS CORRECTAMENTE
======================================================= -->
<div style="position:relative; width:100%; max-width:900px; margin:5px auto 0; height:20px;">

  <!-- LÃNEA HORIZONTAL -->
  <div style="
    position:absolute;
    top:170px;
    left:50%;
    transform:translateX(-50%);
    width:1300px;
    height:1px;
    background:#D0D0D0;
    z-index:3;
  "></div>

  <!-- LÃNEA VERTICAL -->
  <div style="
    position:absolute;
    top:119px;
    left:50%;
    width:2px;
    height:105px;
    transform:translateX(-50%);
    background:#D0D0D0;
    z-index:3;
  "></div>

  <!-- TEXTOS SUPERIORES -->
  <div style="position:absolute; top:70px; left:-270px; color:#D0D0D0; font-weight:bold;">Distal1</div>
  <div style="position:absolute; top:70px; right:-270px; color:#D0D0D0; font-weight:bold;">Distal2</div>
 <div style="position:absolute; top:140px; left:20%; transform:translateX(-50%); color:#D0D0D0; font-weight:bold;">
    Palatino1
  </div>
 <div style="position:absolute; top:140px; left:83%; transform:translateX(-50%); color:#D0D0D0; font-weight:bold;">
    Palatino2
  </div>

  <!-- TEXTOS CENTRALES -->
  <div style="position:absolute; top:180px; left:20%; transform:translateX(-50%); color:#D0D0D0; font-weight:bold;">
    Lingual4
  </div>
  <div style="position:absolute; top:180px; left:83%; transform:translateX(-50%); color:#D0D0D0; font-weight:bold;">
    Lingual3
  </div>
  <div style="position:absolute; top:300px; left:83%; transform:translateX(-50%); color:#D0D0D0; font-weight:bold;">
    Vestibular3
  </div>
  <div style="position:absolute; top:10px; left:83%; transform:translateX(-50%); color:#D0D0D0; font-weight:bold;">
    Vestibular2
  </div>
 <div style="position:absolute; top:10px; left:20%; transform:translateX(-50%); color:#D0D0D0; font-weight:bold;">
    Vestibular1
  </div>
  <div style="position:absolute; top:300px; left:20%; transform:translateX(-50%); color:#D0D0D0; font-weight:bold;">
    Vestibular4
  </div>

  <!-- TEXTOS INFERIORES -->
  <div style="position:absolute; top:230px; left:-270px; color:#D0D0D0; font-weight:bold;">Distal4</div>
  <div style="position:absolute; top:230px; right:-270px; color:#D0D0D0; font-weight:bold;">Distal3</div>
  </div>
 <div style="
    position:absolute;
    top:185px;
    left:49.9%;
    transform:translateX(-50%) rotate(180deg);
    color:#D0D0D0;
    font-weight:bold;
    writing-mode:vertical-rl;
">
    Mesial
</div>
 <div style="
    position:absolute;
    top:350px;
    left:49.9%;
    transform:translateX(-50%) rotate(180deg);
    color:#D0D0D0;
    font-weight:bold;
    writing-mode:vertical-rl;
">
    Mesial
</div>

</div>


<!-- ======================================================
     ðŸ”¥ ODONTOGRAMA ORIGINAL (SIN MODIFICAR)
======================================================= -->
<div class="odontograma">

  <div class="seccion">
    <div class="etiqueta">Maxilar superior</div>
    <div class="fila" id="fila-superior"></div>
  </div>

  <div class="seccion">
    <div class="etiqueta" style="position:relative; top:150px;">Maxilar inferior</div>
    <div class="fila" id="fila-inferior"></div>
  </div>
</div>


<!-- ======================================================
     LEYENDA
======================================================= -->
<div class="leyenda">
  <h2>Leyenda de Preexistencias</h2>
  <div class="leyenda-grid" id="grid-leyenda"></div>
</div>

<div style="text-align:center; margin-top:40px;">
  <button onclick="mostrarReporte()"
          style="padding:10px 20px; background:#0D47A1; color:white; border:none; border-radius:6px; cursor:pointer;">
    Generar reporte de preexistencias
  </button>
</div>


<script>
/* ======================================================
   TODO EL SCRIPT ORIGINAL (NO MODIFICADO)
======================================================= */

  const preexistencias = {
    Caries: 'red',
    Corona: 'blue',
    Endodoncia: '#005E94',
    ObturaciÃ³n: 'green',
    Fractura: 'orange',
    Ausente: 'gray',
    Implante: '#7eff42',
    "ExtracciÃ³n indicada": '#333',
    Exodoncia: '#ff38ef',
    PÃ³ntico: 'cyan',
    "Movilidad dental": 'pink',
    Retenido: 'purple',
    "PrÃ³tesis fija": '#880E4F',
    "PrÃ³tesis removible": '#42ffc6',
    "PrÃ³tesis total": '#fff642',
    Amalgama: '#42b7ff',
    Resina: '#FBC02D',
    Sano: '#8BC34A'
  };

  let reporte = {};

  const contenedorLeyenda = document.getElementById('grid-leyenda');
  Object.entries(preexistencias).forEach(([nombre, color]) => {
    const item = document.createElement('div');
    item.innerHTML =
      `<span class="color-box" style="background:${color}; border:1px solid #444;"></span>${nombre}`;
    contenedorLeyenda.appendChild(item);
  });

  const dientesSuperior =
    [18,17,16,15,14,13,12,11,21,22,23,24,25,26,27,28];
  const dientesInferior =
    [48,47,46,45,44,43,42,41,31,32,33,34,35,36,37,38];

  function crearDiente(numero, contenedor) {
    const contenedorDiente = document.createElement('div');
    contenedorDiente.className = 'contenedor-diente';

    const diente = document.createElement('div');
    diente.className = 'diente';
    diente.dataset.numero = numero;

    ['superior','inferior','izquierda','derecha'].forEach(region => {
      const div = document.createElement('div');
      div.className = `cara ${region}`;
      div.dataset.region = region;
      div.onclick = (event) => mostrarPopup(event, div);
      diente.appendChild(div);
    });

    const centro = document.createElement('div');
    centro.className = 'centro';
    centro.dataset.region = 'centro';
    centro.onclick = (event) => mostrarPopup(event, centro);
    diente.appendChild(centro);

    const label = document.createElement('div');
    label.className = 'numero';
    label.textContent = numero;

    contenedorDiente.appendChild(diente);
    contenedorDiente.appendChild(label);
    contenedor.appendChild(contenedorDiente);
  }

  function mostrarPopup(event, elemento) {
    event.stopPropagation();
    document.querySelectorAll('.popup').forEach(p => p.remove());

    const menu = document.createElement('div');
    menu.className = 'popup';

// ---------- OPCIÃ“N LIMPIAR ----------
const limpiar = document.createElement('div');
limpiar.innerHTML =
  `<span class='color-box' style="background:white; border:1px solid #444;"></span> Limpiar`;

limpiar.onclick = () => {
  elemento.style.background = "white";

  const dienteNumero = elemento.parentElement.dataset.numero;
  const cara = elemento.dataset.region;

  if (reporte[dienteNumero] && reporte[dienteNumero][cara]) {
    delete reporte[dienteNumero][cara];
  }

  if (reporte[dienteNumero] && Object.keys(reporte[dienteNumero]).length === 0) {
    delete reporte[dienteNumero];
  }

  menu.remove();
};

menu.appendChild(limpiar);


    Object.entries(preexistencias).forEach(([nombre, color]) => {
      const item = document.createElement('div');
      item.innerHTML =
        `<span class='color-box' style="background:${color}; border:1px solid #444;"></span>${nombre}`;

      item.onclick = () => {
        elemento.style.background = color;

        const dienteNumero = elemento.parentElement.dataset.numero;
        const cara = elemento.dataset.region;

        if (!reporte[dienteNumero]) reporte[dienteNumero] = {};
        reporte[dienteNumero][cara] = nombre;

        menu.remove();
      };

      menu.appendChild(item);
    });

    document.body.appendChild(menu);
    menu.style.left = `${event.pageX + 5}px`;
    menu.style.top  = `${event.pageY + 5}px`;
    menu.style.display = 'block';
  }

  const filaSuperior = document.getElementById('fila-superior');
  dientesSuperior.forEach(num =>
    crearDiente(num, filaSuperior)
  );

  const filaInferior = document.getElementById('fila-inferior');
  dientesInferior.forEach(num =>
    crearDiente(num, filaInferior)
  );

  document.body.addEventListener('click', () => {
    document.querySelectorAll('.popup').forEach(p => p.remove());
  });


 function obtenerRegion(diente, cara) {
  diente = parseInt(diente);

  // OCLUSAL PARA TODOS
  if (cara === "centro") return "Oclusal";

  /* =======================================
      VESTIBULAR
      Superiores 11â€“18 â†’ cara SUPERIOR
      Superiores 21â€“28 â†’ cara SUPERIOR
  ========================================*/
  if (diente >= 11 && diente <= 18 && cara === "superior")
    return "Vestibular";

  if (diente >= 21 && diente <= 28 && cara === "superior")
    return "Vestibular";

  /* =======================================
      PALATINO
      Superiores 11â€“28 â†’ cara INFERIOR
  ========================================*/
  if (diente >= 11 && diente <= 28 && cara === "inferior")
    return "Palatino";

  /* =======================================
      LINGUAL / VESTIBULAR INFERIOR
      Inferiores 38â€“48 â†’ superior = LINGUAL
      Inferiores 31â€“48 â†’ inferior = VESTIBULAR
  ========================================*/
  if (diente >= 31 && diente <= 48 && cara === "superior")
    return "Lingual";

  if (diente >= 31 && diente <= 48 && cara === "inferior")
    return "Vestibular";

  /* =======================================
       DISTAL
  ========================================*/
  if ((diente >= 11 && diente <= 18) || (diente >= 41 && diente <= 48)) {
    if (cara === "izquierda") return "Distal";
  }

  if ((diente >= 21 && diente <= 28) || (diente >= 31 && diente <= 38)) {
    if (cara === "derecha") return "Distal";
  }

  /* =======================================
       MESIAL
  ========================================*/
  if ((diente >= 11 && diente <= 18) || (diente >= 41 && diente <= 48)) {
    if (cara === "derecha") return "Mesial";
  }

  if ((diente >= 21 && diente <= 28) || (diente >= 31 && diente <= 38)) {
    if (cara === "izquierda") return "Mesial";
  }

  return null;
}


  /* ==================================================
     REPORTE FINAL FORMATO EXCEL
  ================================================== */
  function mostrarReporte() {

    let html = `
      <h2>Reporte de Preexistencias</h2>
      <table border="1" cellpadding="6" style="border-collapse:collapse; margin:20px auto; width:95%; text-align:center;">
        <tr style="background:#eee; font-weight:bold;">
          <th>Diente</th>
          <th>Mesial</th>
          <th>Distal</th>
          <th>Oclusal</th>
          <th>Vestibular</th>
          <th>Lingual</th>
          <th>Palatino</th>
        </tr>
    `;

    Object.entries(reporte).forEach(([diente, caras]) => {

      let fila = {
        Mesial: "",
        Distal: "",
        Oclusal: "",
        Vestibular: "",
        Lingual: "",
        Palatino: ""
      };

      Object.entries(caras).forEach(([cara, preexistencia]) => {
        let region = obtenerRegion(diente, cara);
        if (region) fila[region] = preexistencia.toUpperCase();
      });

      html += `
        <tr>
          <td>${diente}</td>
          <td>${fila.Mesial}</td>
          <td>${fila.Distal}</td>
          <td>${fila.Oclusal}</td>
          <td>${fila.Vestibular}</td>
          <td>${fila.Lingual}</td>
          <td>${fila.Palatino}</td>
        </tr>
      `;
    });

    html += "</table>";

    const win = window.open("", "_blank");
    win.document.write(html);
    win.document.close();
  }

</script>

</body>
</html>
