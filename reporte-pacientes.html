<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Reporte de Pacientes - Clínica Odontológica</title>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.45.4/dist/umd/supabase.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

  <style>
    :root{
      --bg:#f3f5f7;--card:#fff;--text:#1f2a37;--muted:#6b7280;--line:#e5e7eb;
      --brand:#1f6aa5;--brand2:#114a75;--danger:#b42318;
      --shadow:0 10px 30px rgba(16,24,40,.08);--radius:14px;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:Arial,sans-serif;background:var(--bg);color:var(--text);padding:16px}

    .topbar,.container{max-width:100%}
    .topbar{display:flex;justify-content:space-between;gap:12px;flex-wrap:wrap;margin-bottom:12px}

    .container{margin:0 auto;background:var(--card);border:1px solid var(--line);
      border-radius:var(--radius);box-shadow:var(--shadow)}
    .header,.section,.footer{padding:14px 16px;background:#fff}
    .header{border-bottom:1px solid var(--line);display:flex;justify-content:space-between;flex-wrap:wrap}
    .footer{border-top:1px solid var(--line);display:flex;justify-content:space-between;font-size:12px;color:var(--muted)}

    table{width:100%;border-collapse:collapse;table-layout:fixed}
    th,td{padding:10px;border-bottom:1px solid var(--line);font-size:12.5px;text-align:left}
    th{background:#fafafa;color:var(--muted);position:sticky;top:0}

    col.cedula{width:140px}
    col.nombre{width:30%}
    col.telefono{width:140px}
    col.correo{width:25%}
    col.accion{width:110px}

    @media(max-width:900px){
      col.nombre{width:40%}
      col.correo{width:30%}
    }
  </style>
</head>

<body>
<div class="topbar">
  <h1>CLÍNICA ODONTOLÓGICA — Reporte de pacientes</h1>
  <div>
    <button onclick="location.href='index.html'">⬅ Volver</button>
    <button onclick="location.href='login.html'">Cerrar sesión</button>
  </div>
</div>

<div class="container">
  <div class="header">
    <b>Listado de pacientes</b>
    <button onclick="cargar()">Actualizar</button>
  </div>

  <div class="section" style="overflow:auto;max-height:65vh">
    <table>
      <colgroup>
        <col class="cedula"><col class="nombre"><col class="telefono"><col class="correo">
        <col class="accion"><col class="accion"><col class="accion"><col class="accion">
      </colgroup>
      <thead>
        <tr>
          <th>Cédula</th><th>Nombre</th><th>Teléfono</th><th>Correo</th>
          <th>Historia</th><th>Plan</th><th>Factura</th><th>Evol.</th>
        </tr>
      </thead>
      <tbody id="tbody_pacientes">
        <tr><td colspan="8">Cargando...</td></tr>
      </tbody>
    </table>
  </div>

  <div class="footer">© 2026</div>
</div>

<script>
const supabase=window.supabase.createClient(
  "https://dmcfrmpqlkrqbpjhrfyo.supabase.co",
  "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9"
);

async function cargar(){
  const {data}=await supabase.from("HISTORIAS CLINICAS")
    .select('"Numero de Identificacion","Nombre y apellido",paciente_cel,paciente_email');
  const tb=document.getElementById("tbody_pacientes");
  tb.innerHTML="";
  data.forEach(p=>{
    const ced=encodeURIComponent(p["Numero de Identificacion"]);
    tb.innerHTML+=`
    <tr>
      <td>${p["Numero de Identificacion"]}</td>
      <td>${p["Nombre y apellido"]}</td>
      <td>${p.paciente_cel||""}</td>
      <td>${p.paciente_email||""}</td>
      <td><button onclick="location.href='historia-clinica.html?buscar_cedula=${ced}'">ver</button></td>
      <td><button onclick="location.href='plandetratamiento.html?cedula=${ced}'">ver</button></td>
      <td><button onclick="location.href='facturacion.html?paciente_cedula=${ced}'">ver</button></td>
      <td><button onclick="location.href='evoluciones.html?cedula=${ced}'">ver</button></td>
    </tr>`;
  });
}
cargar();
</script>
</body>
</html>








