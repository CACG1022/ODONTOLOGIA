<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Agenda OdontolÃ³gica</title>

  <!-- Supabase -->
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>

  <!-- Fuente -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">

  <style>
    body {
      font-family: 'Inter', sans-serif;
      background: #f4f6f8;
      margin: 0;
      padding: 40px;
      color: #333;
    }

    .container {
      max-width: 1100px;
      margin: auto;
      background: #fff;
      border-radius: 12px;
      padding: 30px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.05);
    }

    h1 {
      margin-bottom: 20px;
    }

    .filters {
      display: flex;
      gap: 15px;
      margin-bottom: 25px;
      flex-wrap: wrap;
    }

    .filters input, .filters select {
      padding: 10px 14px;
      border-radius: 8px;
      border: 1px solid #ccc;
      font-size: 14px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
    }

    th, td {
      padding: 14px;
      text-align: left;
    }

    th {
      background: #f1f3f5;
      font-weight: 600;
      font-size: 14px;
    }

    tr {
      border-bottom: 1px solid #eaeaea;
    }

    .estado {
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
      text-transform: capitalize;
      display: inline-block;
    }

    .confirmado {
      background: #d1fae5;
      color: #065f46;
    }

    .programado {
      background: #fef3c7;
      color: #92400e;
    }

    .cancelado {
      background: #fee2e2;
      color: #991b1b;
    }

    .hora {
      font-weight: 600;
    }
  </style>
</head>
<body>

<div class="container">
  <h1>ðŸ¦· Agenda de Pacientes</h1>

  <div class="filters">
    <input type="date" id="fecha">
    <select id="profesional">
      <option value="">Todos los profesionales</option>
    </select>
  </div>

  <table>
    <thead>
      <tr>
        <th>Hora</th>
        <th>Paciente</th>
        <th>Profesional</th>
        <th>Especialidad</th>
        <th>Estado</th>
      </tr>
    </thead>
    <tbody id="tabla-citas"></tbody>
  </table>
</div>

<script>
  const supabase = window.supabase.createClient(
    'https://dmcfrmpqlkrqbpjhrfyo.supabase.co',
    'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRtY2ZybXBxbGtycWJwamhyZnlvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI5MzU0MDIsImV4cCI6MjA3ODUxMTQwMn0.YY_6t_lCTs5mK-a_eEdBFa6l9_NBM3B4YDtWOXayCBE'
  );

  const tabla = document.getElementById('tabla-citas');
  const fechaInput = document.getElementById('fecha');
  const profesionalSelect = document.getElementById('profesional');

  // Fecha de hoy por defecto
  const hoy = new Date().toISOString().split('T')[0];
  fechaInput.value = hoy;

  async function cargarProfesionales() {
    const { data } = await supabase
      .from('citas')
      .select('nombre_profesional')
      .not('nombre_profesional', 'is', null);

    const profesionales = [...new Set(data.map(p => p.nombre_profesional))];

    profesionales.forEach(p => {
      const option = document.createElement('option');
      option.value = p;
      option.textContent = p;
      profesionalSelect.appendChild(option);
    });
  }

  async function cargarCitas() {
    tabla.innerHTML = '';

    const fecha = fechaInput.value;
    const profesional = profesionalSelect.value;

    let query = supabase
      .from('citas')
      .select('*')
      .gte('inicio', `${fecha}T00:00:00`)
      .lte('inicio', `${fecha}T23:59:59`)
      .order('inicio', { ascending: true });

    if (profesional) {
      query = query.eq('nombre_profesional', profesional);
    }

    const { data, error } = await query;

    if (error) {
      alert('Error cargando citas');
      return;
    }

    data.forEach(cita => {
      const hora = new Date(cita.inicio).toLocaleTimeString('es-CO', {
        hour: '2-digit',
        minute: '2-digit'
      });

      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td class="hora">${hora}</td>
        <td>${cita.nombre_paciente}</td>
        <td>${cita.nombre_profesional}</td>
        <td>${cita.especialidad || '-'}</td>
        <td>
          <span class="estado ${cita.estado}">
            ${cita.estado}
          </span>
        </td>
      `;
      tabla.appendChild(tr);
    });
  }

  fechaInput.addEventListener('change', cargarCitas);
  profesionalSelect.addEventListener('change', cargarCitas);

  cargarProfesionales();
  cargarCitas();
</script>

</body>
</html>
